<!DOCTYPE html>
<html>
<head>
    <title>Sample03</title>
</head>
<body style="padding: 0px; margin: 0px;">
    <img
      src="https://timkadlec.com/test/mq-svg/kiwi-mq.svg"
      height="300"
      width="300"
      style="margin: 0px; position: relative; left: 1px; top: 0px;" />
    <script>
        {
            var img = document.querySelector('img');
            var scale = 1;
            var offsetX = 0;
            var offsetY = 0;
            img.style.transformOrigin = '0px 0px';
            // img.style.transform = 'scale(2,2)'
            // img.style.transformOrigin = '50% 50%';

            img.onmousemove = function(e){
                var mousex = e.offsetX;  // 永遠回傳 scale=1 的 mouse position.x
                var mousey = e.offsetY;  // 永遠回傳 scale=1 的 mouse position.y
                // var mousex = e.clientX - img.offsetLeft;
                // var mousey = e.clientY - img.offsetTop;
                console.log(mousex, mousey);  // equal: console.log(e.clientX, e.clientY);
            };

            img.onwheel = function(e){
                console.log(e);
                // console.log(e.offsetX, e.offsetY);
                e.preventDefault();
                var mousex = e.offsetX;  // 永遠回傳 scale=1 的 mouse position.x
                var mousey = e.offsetY;  // 永遠回傳 scale=1 的 mouse position.y
                // var mousex = e.clientX - img.offsetLeft;
                // var mousey = e.clientY - img.offsetTop;
                console.log(mousex, mousey, scale);
                var old_scale = scale;
                if(e.deltaY > 0){
                    scale *= 2;
                }
                else{
                    scale *= .5;
                }


                // 算出 scale 後當前滑鼠相對於 img 內的座標會差多少 Pixel, ex: (10, 10), scale(1.5) => (15,15).
                // 所以需要往回移動 5px / scale
                // (300, 300) scale(2) => (600, 600)
                // 所以需要往回移動 300px / scale (因為在 scale=2 時移動 300 會相當於物理畫面的 600)
                //
                // mouseOriginPosX * Scale = DevicePosX(真實物理)
                // mouseOriginPosY * Scale = DevicePosY(真實物理)
                // ex: scale=2 originWidth=200 -> DeviceWidth=400
                //     放大前後物理距離就相差: 400 - 200 = 200
                //     放大後要往左移動 200 物理距離，所以只需要移動 100 因為 scale=2 就會有 200 物理距離的效果
                var $offsetX = mousex * scale - mousex * old_scale;
                var $offsetY = mousey * scale - mousey * old_scale;

                offsetX = offsetX - $offsetX;
                offsetY = offsetY - $offsetY;
                // scale=2 後移動 1pixel 會相當於物理畫面的 2pixel
                img.style.transform = 'scale(' + scale + ')' + ' translate(' + offsetX/scale + 'px,' + offsetY/scale + 'px)';
            }
        }
    </script>
</body>
</html>